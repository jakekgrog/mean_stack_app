<h1 class="page-header">View Listing</h1>

<div class="row show-hide-message" *ngIf="message">
  <div [ngClass]="messageClass">
    {{ message }}
  </div>
</div>

<div class="col-md-12" *ngIf="foundListing">
  <div class="panel panel-primary">
    <div class="panel-heading">
      <h3 class="panel-title">{{ listing.title }}</h3><br>
      <div class="panel-footer" style="color: black">
        {{ listing.body }}
      </div>
      <div class="panel-body">
        <h5 style="color: white;"><strong>Posted by: </strong> {{ listing.createdBy }}</h5>

        <h5 style="color: white;"><strong>Date: </strong> {{ listing.createdAt | date:'MMM dd, yyyy' }}</h5>

        <a routerLink='/listing'><button class="btn btn-success">Go Back</button></a>
      </div>
    </div>
  </div>

  <ul class="list-group">
    <li class="list-group-item">
      <button [disabled]="newReview.indexOf(listing._id) > -1" type="button" name="button" class="btn btn-sm btn-danger" (click)="draftReview(listing._id)">Post Review</button>
      <br>
      <div *ngIf="newReview.indexOf(listing._id) > -1">
        <br>
        <form [formGroup]="reviewForm">
          <textarea name="comment" cols="30" rows="10" class="form-control" formControlName="comment"></textarea>
          <div [ngClass]="">
            <ul class="help-block">
              <li *ngIf="reviewForm.controls.comment.errors?.required && reviewForm.controls.comment.dirty">This field is required</li>
              <li *ngIf="(reviewForm.controls.comment.errors?.maxLength && reviewForm.controls.comment.dirty) || (reviewForm.controls.comment.errors?.minLength && reviewForm.controls.comment.dirty)">Comment must be between 1 and 500 characters.</li>
            </ul>
          </div>
          <button [disabled]="!reviewForm.valid || processing" type="submit" name="button" class="btn btn-sm btn-info" (click)="postReview(listing._id)">Submit Review</button>
          <button [disabled]="processing" type="button" name="button" class="btn btn-sm btn-danger" (click)="cancelSubmission(listing._id)">Cancel</button>
        </form>
      </div>
      <li *ngIf="enabledReviews.indexOf(listing._id) === -1 && listing.reviews.length > 0" class="list-group-item">
        <span (click)="expand(listing._id)">
          Show Reviews&nbsp;&nbsp;
          <div class="glyphicon glyphicon-comment"></div>
        </span>
      </li>
      <li *ngIf="enabledReviews.indexOf(listing._id) > -1" class="list-group-item">
        <span (click)="collapse(listing._id)">
          Hide Reviews&nbsp;&nbsp;
          <div class="glyphicon glyphicon-comment"></div>
        </span>
      </li>
      <div *ngIf="enabledReviews.indexOf(listing._id) >-1">
        <li *ngFor="let review of listing.reviews" class="list-group-item">
          <strong>{{ review.commentator }}:</strong> {{ review.comment }}
        </li>
      </div>
    
  </ul>
</div>